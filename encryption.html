<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Encryption &#8212; jrnl 1.9.8 documentation</title>
    
    <link rel="stylesheet" href="_static/css/jrnl.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.9.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Import and Export" href="export.html" />
    <link rel="prev" title="Basic Usage" href="usage.html" />
     
    <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
    <link rel="apple-touch-icon-precomposed" href="_static/img/favicon-152.png">
    <link rel="shortcut icon" href="_static/img/favicon.ico">
  
  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="encryption">
<span id="id1"></span><h1>Encryption<a class="headerlink" href="#encryption" title="Permalink to this headline">¶</a></h1>
<div class="section" id="encrypting-and-decrypting">
<h2>Encrypting and decrypting<a class="headerlink" href="#encrypting-and-decrypting" title="Permalink to this headline">¶</a></h2>
<p>If you don&#8217;t choose to encrypt your file when you run <cite>jrnl</cite> for the first time, you can encrypt your existing journal file or change its password using</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">jrnl</span> <span class="o">--</span><span class="n">encrypt</span>
</pre></div>
</div>
<p>If it is already encrypted, you will first be asked for the current password. You can then enter a new password and your plain journal will replaced by the encrypted file. Conversely,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">jrnl</span> <span class="o">--</span><span class="n">decrypt</span>
</pre></div>
</div>
<p>will replace your encrypted journal file by a Journal in plain text. You can also specify a filename, ie. <code class="docutils literal"><span class="pre">jrnl</span> <span class="pre">--decrypt</span> <span class="pre">plain_text_copy.txt</span></code>, to leave your original file untouched.</p>
</div>
<div class="section" id="storing-passwords-in-your-keychain">
<h2>Storing passwords in your keychain<a class="headerlink" href="#storing-passwords-in-your-keychain" title="Permalink to this headline">¶</a></h2>
<p>Whenever you encrypt your journal, you are asked whether you want to store the encryption password in your keychain. If you do this, you won&#8217;t have to enter your password every time you want to write or read your journal.</p>
<p>If you don&#8217;t initially store the password in the keychain but decide to do so at a later point &#8211; or maybe want to store it on one computer but not on another &#8211; you can simply run <code class="docutils literal"><span class="pre">jrnl</span> <span class="pre">--encrypt</span></code> on an encrypted journal and use the same password again.</p>
</div>
<div class="section" id="a-note-on-security">
<h2>A note on security<a class="headerlink" href="#a-note-on-security" title="Permalink to this headline">¶</a></h2>
<p>While jrnl follows best practises, true security is an illusion. Specifically, jrnl will leave traces in your memory and your shell history &#8211; it&#8217;s meant to keep journals secure in transit, for example when storing it on an <a class="reference external" href="http://techcrunch.com/2014/04/09/condoleezza-rice-joins-dropboxs-board/">untrusted</a> services such as Dropbox. If you&#8217;re concerned about security, disable history logging for journal in your <code class="docutils literal"><span class="pre">.bashrc</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">HISTIGNORE</span><span class="o">=</span><span class="s2">&quot;$HISTIGNORE:jrnl *&quot;</span>
</pre></div>
</div>
<p>If you are using zsh instead of bash, you can get the same behaviour adding this to your <code class="docutils literal"><span class="pre">zshrc</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">setopt</span> <span class="n">HIST_IGNORE_SPACE</span>
<span class="n">alias</span> <span class="n">jrnl</span><span class="o">=</span><span class="s2">&quot; jrnl&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="manual-decryption">
<h2>Manual decryption<a class="headerlink" href="#manual-decryption" title="Permalink to this headline">¶</a></h2>
<p>Should you ever want to decrypt your journal manually, you can do so with any program that supports the AES algorithm in CBC. The key used for encryption is the SHA-256-hash of your password, the IV (initialisation vector) is stored in the first 16 bytes of the encrypted file. The plain text is encoded in UTF-8 and padded according to PKCS#7 before being encrypted. Here&#8217;s a Python script that you can use to decrypt your journal:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="k">import</span> <span class="n">AES</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;filepath&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;journal file to decrypt&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="n">pwd</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">()</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">pwd</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">crypto</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">ciphertext</span><span class="p">[:</span><span class="mi">16</span><span class="p">])</span>
<span class="n">plain</span> <span class="o">=</span> <span class="n">crypto</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">[</span><span class="mi">16</span><span class="p">:])</span>
<span class="n">plain</span> <span class="o">=</span> <span class="n">plain</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">plain</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">plain</span> <span class="o">=</span> <span class="n">plain</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">plain</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
  <aside>
    <a href="index.html" id="logolink" title="jrnl"><img class="logo" src="_static/img/logo.png" width="90px" height="98px" title="jrnl"/></a>
    <h2>Documentation</h2>
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Basic Usage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Encryption</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#encrypting-and-decrypting">Encrypting and decrypting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#storing-passwords-in-your-keychain">Storing passwords in your keychain</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-note-on-security">A note on security</a></li>
<li class="toctree-l2"><a class="reference internal" href="#manual-decryption">Manual decryption</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="export.html">Import and Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">FAQ</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  </aside>
  
      <div class="clearer"></div>
    </div>
      <div class="footer">
          jrnl is made with love by <a href="http://www.1450.me">Manuel Ebert</a> and <a href="https://github.com/maebert/jrnl/graphs/contributors" title="Contributors">other fabulous people</a>. If you need help, tweet to <a href="https://twitter.com/maebert" title="Follow @maebert on twitter">@maebert</a> or <a href="https://github.com/maebert/jrnl/issues/new" title="Open a new issue on Github">submit an issue</a> on Github.
      </div>
  </body>
</html>